{"version":3,"sources":["../src/moderation.js"],"names":["define","$","Log","Config","Ajax","Templates","ModalFactory","ModalEvents","Moderation","rootel","self","modals","APPROVE","REJECT","DEFER","VIEWUSERS","templates","ispagesingle","hasClass","prototype","main","on","e","preventDefault","button","approveAnnouncement","rejectAnnouncement","deferAnnouncement","viewAnnouncementUsers","preloads","loadModal","types","SAVE_CANCEL","DEFAULT","loadTemplate","when","apply","then","addClass","announcement","closest","subject","find","first","html","id","data","setBody","getRoot","save","call","methodname","args","done","fadeOut","remove","window","location","href","wwwroot","fail","reason","error","debug","show","author","render","rejectcomment","val","comment","postid","altmodlist","length","showError","moderators","defermoderator","defermoderatorval","children","defercommentval","moderator","response","modalkey","title","buttontext","type","create","modal","setTitle","setSaveButtonText","getBackdrop","templatekey","message","ERROR","init","moderation"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the local_announcements/moderation module\n *\n * @package   local_announcements\n * @category  output\n * @copyright 2020 Michael Vangelovski <michael.vangelovski@hotmail.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module local_announcements/moderation\n */\ndefine(['jquery', 'core/log', 'core/config', 'core/ajax','core/templates', 'core/modal_factory', 'core/modal_events' ], \n        function($, Log, Config, Ajax, Templates, ModalFactory, ModalEvents) {    \n    'use strict';\n\n    /**\n     * Initializes the moderation component.\n     */\n    function init() {\n        Log.debug('local_announcements/moderation: initializing');\n\n        var rootel = $('.lann-moderation').first();\n\n        if (!rootel.length) {\n            Log.error('local_announcements/moderation: .local_announcements element not found!');\n            return;\n        }\n\n        var moderation = new Moderation(rootel);\n        moderation.main();\n    }\n\n\n    /**\n     * The constructor\n     *\n     * @constructor\n     * @param {jQuery} rootel\n     */\n    function Moderation(rootel) {\n        var self = this;\n        self.rootel = rootel;\n\n        self.modals = {\n            APPROVE: null,\n            REJECT: null,\n            DEFER: null,\n            VIEWUSERS: null,\n        };\n        self.templates = {\n            REJECT: 'local_announcements/moderation_modal_reject',\n            DEFER: 'local_announcements/moderation_modal_defer',\n            VIEWUSERS: 'local_announcements/announcement_users_list',\n        };\n\n        self.ispagesingle = $('body').hasClass('moderation-single');\n    }\n\n    /**\n     * Run the Audience Selector.\n     *\n     */\n   Moderation.prototype.main = function () {\n        var self = this;\n\n        // Handle approve button click.\n        self.rootel.on('click', '.announcement .action-approve', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.approveAnnouncement(button);\n        });\n\n        // Handle reject announcement button click.\n        self.rootel.on('click', '.announcement .action-reject', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.rejectAnnouncement(button);\n        });\n\n        // Handle defer announcement button click.\n        self.rootel.on('click', '.announcement .action-defer', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.deferAnnouncement(button);\n        });\n\n        // Handle view users button click.\n        self.rootel.on('click', '.announcement .action-viewusers', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.viewAnnouncementUsers(button);\n        });\n\n        // Preload the modals and templates.\n        var preloads = [];\n        preloads.push(self.loadModal('APPROVE', 'Approve Announcement', 'Approve', ModalFactory.types.SAVE_CANCEL));\n        preloads.push(self.loadModal('REJECT', 'Reject Announcement', 'Reject', ModalFactory.types.SAVE_CANCEL));\n        preloads.push(self.loadModal('DEFER', 'Reassign Moderation', 'Reassign', ModalFactory.types.SAVE_CANCEL));\n        preloads.push(self.loadModal('ERROR', 'Error', '', ModalFactory.types.DEFAULT));\n        preloads.push(self.loadModal('VIEWUSERS', 'Announcement Recipients'));\n        preloads.push(self.loadTemplate('REJECT'));\n        preloads.push(self.loadTemplate('VIEWUSERS'));\n        // Do not show actions until all modals and templates are preloaded.\n        $.when.apply($, preloads).then(function() {\n            self.rootel.addClass('preloads-completed');\n        })\n\n    };\n\n    /**\n     * Approve an announcement.\n     *\n     * @method approveAnnouncement\n     */\n    Moderation.prototype.approveAnnouncement = function (button) {\n        var self = this;\n\n        var announcement = button.closest('.announcement');\n        var subject = announcement.find('.subject').first().html();\n        var id = announcement.data('id');\n\n        if (self.modals.APPROVE) {\n            self.modals.APPROVE.setBody('<p>Please confirm that you want to approve:<br><span style=\"font-style:italic;\">' + subject + '</span></p>');\n            self.modals.APPROVE.getRoot().on(ModalEvents.save, function(e) {\n                Ajax.call([{\n                    methodname: 'local_announcements_mod_approve',\n                    args: { id: id },\n                    done: function(response) {\n                        announcement.addClass('removing');\n                        announcement.fadeOut(1000, function() {\n                            announcement.remove();\n                            if (self.ispagesingle) {\n                                window.location.href = Config.wwwroot + \"/local/announcements/moderation.php\";\n                            }\n                        });\n                    },\n                    fail: function(reason) {\n                        Log.error('local_announcements/moderation: failed to approve the announcement');\n                        Log.debug(reason);\n                    }\n                }]);\n            });\n            self.modals.APPROVE.show();\n        }\n    };\n\n    /**\n     * Reject an announcement.\n     *\n     * @method rejectAnnouncement\n     */\n    Moderation.prototype.rejectAnnouncement = function (button) {\n        var self = this;\n\n        var announcement = button.closest('.announcement');\n        var data = {\n            subject: announcement.find('.subject').first().html(),\n            author: announcement.find('.author').first().html(),\n        };\n        var id = announcement.data('id');\n\n        if (self.modals.REJECT) {\n            Templates.render(self.templates.REJECT, data).done(function(html){ \n                self.modals.REJECT.setBody(html);\n                var rejectcomment = $('[name=\"reject-comment\"]');\n                self.modals.REJECT.getRoot().on(ModalEvents.save, function(e) {\n                    if (rejectcomment.val() == \"\") {\n                        e.preventDefault();\n                        rejectcomment.addClass('is-invalid');\n                        return;\n                    }\n                    Ajax.call([{\n                        methodname: 'local_announcements_mod_reject',\n                        args: { \n                            id: id,\n                            comment: rejectcomment.val(),\n                        },\n                        done: function(response) {\n                            announcement.addClass('removing');\n                            announcement.fadeOut(1000, function() {\n                                announcement.remove();\n                                if (self.ispagesingle) {\n                                    window.location.href = Config.wwwroot + \"/local/announcements/moderation.php\";\n                                }\n                            });\n                        },\n                        fail: function(reason) {\n                            Log.error('local_announcements/moderation: failed to reject the announcement');\n                            Log.debug(reason);\n                        }\n                    }]);\n                });\n            });\n            self.modals.REJECT.show();\n        }\n    };\n\n    /**\n     * Reassign an announcement.\n     *\n     * @method rejectAnnouncement\n     */\n    Moderation.prototype.deferAnnouncement = function (button) {\n        var self = this;\n        var announcement = button.closest('.announcement');\n        var id = announcement.data('id');\n\n        if (self.modals.DEFER) {\n            // Get a list of alternate moderators for this post.\n            var altmods = Ajax.call([{\n                methodname: 'local_announcements_get_alternate_moderators',\n                args: { postid: id },\n                done: function(altmodlist) {\n                    if (altmodlist['moderators'].length == 0) {\n                        self.showError('<p>There are no moderators with equivalent or higher privileges than you.</p>');\n                        return;\n                    }\n                    var data = {\n                        subject: announcement.find('.subject').first().html(),\n                        author: announcement.find('.author').first().html(),\n                        moderators: altmodlist,\n                    };\n                    // Render the template with the list of moderators.\n                    Templates.render(self.templates.DEFER, data).done(function(html) { \n                        self.modals.DEFER.setBody(html);\n                        var defermoderator = $('[name=\"defer-moderator\"]');\n                        var defermoderatorval = defermoderator.children(\"option:selected\").val();\n                        var defercommentval = $('[name=\"defer-comment\"]').val();\n                        self.modals.DEFER.getRoot().on(ModalEvents.save, function(e) {\n                            if (defermoderatorval == \"\") {\n                                e.preventDefault();\n                                defermoderator.addClass('is-invalid');\n                                return;\n                            }\n                            // Submit.\n                            Ajax.call([{\n                                methodname: 'local_announcements_mod_defer',\n                                args: { \n                                    id: id,\n                                    moderator: defermoderatorval,\n                                    comment: defercommentval,\n                                },\n                                done: function(response) {\n                                    announcement.addClass('removing');\n                                    announcement.fadeOut(1000, function() {\n                                        announcement.remove();\n                                        if (self.ispagesingle) {\n                                            window.location.href = Config.wwwroot + \"/local/announcements/moderation.php\";\n                                        }\n                                    });\n                                },\n                                fail: function(reason) {\n                                    Log.error('local_announcements/moderation: failed to reassign the announcement');\n                                    Log.debug(reason);\n                                }\n                            }]);\n                        });\n                    });\n                    self.modals.DEFER.show();\n                },\n                fail: function(reason) {\n                    Log.error('local_announcements/moderation: failed to get the list of alternate moderators');\n                    Log.debug(reason);\n                    self.showError('<p>Failed to retrieve a list of alternate moderators.</p>');\n                }\n            }]);\n        }\n    };\n\n    /**\n     * View a list of users for an announcement\n     *\n     * @method\n     */\n    Moderation.prototype.viewAnnouncementUsers = function (button) {\n        var self = this;\n\n        var announcement = button.closest('.announcement');\n        var id = announcement.data('id');\n\n        if (self.modals.VIEWUSERS) {\n            self.modals.VIEWUSERS.setBody('<div style=\"font-style:italic;\">... Fetching user list ...<div class=\"loader\" style=\"display:block;\"><div class=\"circle spin\"></div></div></div>');\n            self.modals.VIEWUSERS.show();\n            Ajax.call([{\n                methodname: 'local_announcements_get_announcement_users',\n                args: { id: id },\n                done: function(response) {\n                    Templates.render(self.templates.VIEWUSERS, response)\n                        .done(function(html) {\n                            self.modals.VIEWUSERS.setBody(html);\n                        })\n                        .fail(function(reason) {\n                            Log.debug(reason);\n                            return \"Failed to render announcement user list.\"\n                        });\n                },\n                fail: function(reason) {\n                    Log.error('local_announcements/list: unable to get announcemnt users.');\n                    Log.debug(reason);\n                }\n            }]);\n        }\n    };\n\n    /**\n     * Helper used to preload a modal\n     *\n     * @method loadModal\n     * @param {string} modalkey The property of the global modals variable\n     * @param {string} title The title of the modal\n     * @param {string} title The button text of the modal\n     * @return {object} jQuery promise\n     */\n    Moderation.prototype.loadModal = function (modalkey, title, buttontext, type) {\n        var self = this;\n        return ModalFactory.create({type: type}).then(function(modal) {\n            modal.setTitle(title);\n            if (buttontext) {\n                modal.setSaveButtonText(buttontext);\n            }\n            self.modals[modalkey] = modal;\n            // Preload backgrop.\n            modal.getBackdrop();\n        });\n    }\n\n    /**\n     * Helper used to preload a template\n     *\n     * @method loadTemplate\n     * @param {string} templatekey The property of the global templates variable\n     * @return {object} jQuery promise\n     */\n    Moderation.prototype.loadTemplate = function (templatekey) {\n        var self = this;\n        return Templates.render(self.templates[templatekey], {});\n    }\n\n\n    /**\n     * Helper used to display error modal\n     *\n     * @method showError\n     * @param {string} message\n     */\n    Moderation.prototype.showError = function (message) {\n        var self = this;\n        self.modals.ERROR.setBody(message);\n        self.modals.ERROR.show();\n    }\n    \n\n    return {\n        init: init\n    };\n});"],"file":"moderation.min.js"}