{"version":3,"sources":["../src/list.js"],"names":["define","$","Log","Config","Ajax","Templates","Str","ModalFactory","ModalEvents","List","rootel","self","modals","DELETE","VIEWUSERS","VIEWAS","VIEWBY","templates","prototype","main","on","e","preventDefault","button","deleteAnnouncement","viewAnnouncementUsers","viewAs","viewBy","viewBySelf","getFullMessage","preloads","loadModal","types","SAVE_CANCEL","DEFAULT","loadTemplate","when","apply","then","addClass","InfiniteScroll","path","append","history","status","setBody","getRoot","save","viewas","val","window","location","href","wwwroot","show","viewby","announcement","closest","id","data","getModal","call","methodname","args","done","response","count","Object","keys","length","setTitle","render","html","fail","reason","debug","error","subject","find","first","fadeOut","remove","removeClass","modalkey","title","buttontext","type","create","modal","setSaveButtonText","getBackdrop","templatekey","init","rootselector","list"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the local_announcements/list module\n *\n * @package   local_announcements\n * @category  output\n * @copyright 2020 Michael Vangelovski <michael.vangelovski@hotmail.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module local_announcements/list\n */\ndefine(['jquery', 'core/log', 'core/config', 'core/ajax','core/templates', \n        'core/str', 'core/modal_factory', 'core/modal_events' ], \n        function($, Log, Config, Ajax, Templates, Str, ModalFactory, ModalEvents) {    \n    'use strict';\n\n    /**\n     * Initializes the list component.\n     */\n    function init(rootselector) {\n        Log.debug('local_announcements/list: initializing');\n\n        var rootel = $(rootselector).first();\n\n        if (!rootel.length) {\n            Log.error('local_announcements/list: ' + rootselector + ' element not found!');\n            return;\n        }\n\n        var list = new List(rootel);\n        list.main();\n    }\n\n\n    /**\n     * The constructor\n     *\n     * @constructor\n     * @param {jQuery} rootel\n     */\n    function List(rootel) {\n        var self = this;\n        self.rootel = rootel;\n\n        self.modals = {\n            DELETE: null,\n            VIEWUSERS: null,\n            VIEWAS: null,\n            VIEWBY: null,\n        };\n        self.templates = {\n            VIEWUSERS: 'local_announcements/announcement_users_list',\n        };\n    }\n\n\n    /**\n     * Run the Audience Selector.\n     *\n     */\n   List.prototype.main = function () {\n        var self = this;\n\n        // Handle delete announcement button click.\n        self.rootel.on('click', '.announcement .action-delete', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.deleteAnnouncement(button);\n        });\n\n        // Handle view users button click.\n        self.rootel.on('click', '.announcement .action-viewusers', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.viewAnnouncementUsers(button);\n        });\n\n        // Handle view as button click.\n        self.rootel.on('click', '.option-viewas', function(e) {\n            e.preventDefault();\n            self.viewAs();\n        });\n\n        // Handle view by button click.\n        self.rootel.on('click', '.option-viewby', function(e) {\n            e.preventDefault();\n            self.viewBy();\n        });\n\n        // Handle view by self button click.\n        self.rootel.on('click', '.option-viewbyself', function(e) {\n            e.preventDefault();\n            self.viewBySelf();\n        });\n\n        // Handle view full message link.\n        self.rootel.on('click', '.view-full-link', function(e) {\n            e.preventDefault();\n            var button = $(this);\n            self.getFullMessage(button);\n        });\n\n        // Preload the modals and templates.\n        var preloads = [];\n        preloads.push(self.loadModal('DELETE', 'Delete Announcement', 'Delete', ModalFactory.types.SAVE_CANCEL));\n        preloads.push(self.loadModal('VIEWUSERS', 'Announcement Recipients', '', ModalFactory.types.DEFAULT));\n        preloads.push(self.loadModal('VIEWAS', 'View as another user', 'Go', ModalFactory.types.SAVE_CANCEL));\n        preloads.push(self.loadModal('VIEWBY', 'View by creator', 'Go', ModalFactory.types.SAVE_CANCEL));\n        preloads.push(self.loadTemplate('VIEWUSERS'));\n        // Do not show actions until all modals and templates are preloaded.\n        $.when.apply($, preloads).then(function() {\n            self.rootel.addClass('preloads-completed');\n        })\n\n        // set up infinite scroll\n        if(typeof InfiniteScroll != 'undefined') {\n          var infScroll = new InfiniteScroll( '.lann-list', {\n            // options\n            path: '.next',\n            append: '.announcement',\n            history: false,\n            status: '.page-load-status',\n          });\n        }\n\n    };\n\n    /**\n     * View announcements from the perspective of a specified user.\n     *\n     * @method\n     */\n    List.prototype.viewAs = function () {\n        var self = this;\n\n        if (self.modals.VIEWAS) {\n            self.modals.VIEWAS.setBody('<p>Enter the ID of a user:</p><p><input class=\"form-control\" id=\"viewas-user\" size=\"48\"/></p>');\n            self.modals.VIEWAS.getRoot().on(ModalEvents.save, function(e) {\n              var viewas = $('input#viewas-user').val();\n              window.location.href = Config.wwwroot + \"/local/announcements/index.php?viewas=\" + viewas;\n            });\n            self.modals.VIEWAS.show();\n        }\n    };\n\n    /**\n     * View announcements created by a specified user.\n     *\n     * @method\n     */\n    List.prototype.viewBy = function () {\n        var self = this;\n\n        if (self.modals.VIEWBY) {\n            self.modals.VIEWBY.setBody('<p>Enter the ID of a user:</p><p><input class=\"form-control\" id=\"viewby-user\" size=\"48\"/></p>');\n            self.modals.VIEWBY.getRoot().on(ModalEvents.save, function(e) {\n              var viewby = $('input#viewby-user').val();\n              window.location.href = Config.wwwroot + \"/local/announcements/index.php?viewby=\" + viewby;\n            });\n            self.modals.VIEWBY.show();\n        }\n    };\n\n    /**\n     * View announcements created by a specified user.\n     *\n     * @method\n     */\n    List.prototype.viewBySelf = function () {\n        var self = this;\n        window.location.href = Config.wwwroot + \"/local/announcements/index.php?viewby=self\";\n    };\n\n    /**\n     * View a list of users for an announcement\n     *\n     * @method\n     */\n    List.prototype.viewAnnouncementUsers = function (button) {\n        var self = this;\n\n        var announcement = button.closest('.announcement');\n        var id = announcement.data('id');\n\n        if (self.modals.VIEWUSERS) {\n            self.modals.VIEWUSERS.getModal().addClass('modal-xl');\n            self.modals.VIEWUSERS.setBody('<div style=\"font-style:italic;\">... Fetching user list ...<div class=\"loader\" style=\"display:block;\"><div class=\"circle spin\"></div></div></div>');\n            self.modals.VIEWUSERS.show();\n            Ajax.call([{\n                methodname: 'local_announcements_get_announcement_users',\n                args: { id: id },\n                done: function(response) {\n                    var count = Object.keys(response['userslist']).length;\n                    self.modals.VIEWUSERS.setTitle('Audience Recipients (' + count + ')');\n                    Templates.render(self.templates.VIEWUSERS, response)\n                        .done(function(html) {\n                            self.modals.VIEWUSERS.setBody(html);\n                        })\n                        .fail(function(reason) {\n                            Log.debug(reason);\n                            return \"Failed to render announcement user list.\"\n                        });\n                },\n                fail: function(reason) {\n                    Log.error('local_announcements/list: unable to get announcemnt users.');\n                    Log.debug(reason);\n                }\n            }]);\n        }\n    };\n\n    /**\n     * Delete an announcement.\n     *\n     * @method\n     */\n    List.prototype.deleteAnnouncement = function (button) {\n        var self = this;\n\n        var announcement = button.closest('.announcement');\n        var subject = announcement.find('.subject').first().html();\n        var id = announcement.data('id');\n\n        if (self.modals.DELETE) {\n            self.modals.DELETE.setBody('<p>Please confirm that you want to delete:<br><span style=\"font-style:italic;\">' + subject + '</span></p>');\n            self.modals.DELETE.getRoot().on(ModalEvents.save, function(e) {\n                Ajax.call([{\n                    methodname: 'local_announcements_delete_announcement',\n                    args: { id: id },\n                    done: function(response) {\n                        announcement.addClass('removing');\n                        announcement.fadeOut(1000, function() {\n                            $(this).remove();\n                        });\n                    },\n                    fail: function(reason) {\n                        Log.error('local_announcements/list: unable to delete the announcement');\n                        Log.debug(reason);\n                    }\n                }]);\n            });\n            self.modals.DELETE.show();\n        }\n    };\n\n    /**\n     * Load the full message of a truncated announcement.\n     *\n     * @method\n     */\n    List.prototype.getFullMessage = function (button) {\n        var self = this;\n\n        var announcement = button.closest('.announcement');\n        var id = announcement.data('id');\n\n        announcement.addClass('fetching-full');\n        Ajax.call([{\n            methodname: 'local_announcements_get_full_message',\n            args: { id: id },\n            done: function(response) {\n                announcement.removeClass('fetching-full');\n                announcement.addClass('full-message');\n                announcement.find('.message').html(response['fullmessage']);\n            },\n            fail: function(reason) {\n                announcement.removeClass('fetching-full');\n                Log.error('local_announcements/list: unable to get full message.');\n                Log.debug(reason);\n            }\n        }]);\n    };\n\n    /**\n     * Helper used to preload a modal\n     *\n     * @method loadModal\n     * @param {string} modalkey The property of the global modals variable\n     * @param {string} title The title of the modal\n     * @param {string} title The button text of the modal\n     * @return {object} jQuery promise\n     */\n    List.prototype.loadModal = function (modalkey, title, buttontext, type) {\n        var self = this;\n        return ModalFactory.create({type: type}).then(function(modal) {\n            modal.setTitle(title);\n            if (buttontext) {\n                modal.setSaveButtonText(buttontext);\n            }\n            self.modals[modalkey] = modal;\n            // Preload backgrop.\n            modal.getBackdrop();\n            modal.getRoot().addClass('modal-' + modalkey);\n        });\n    }\n\n    /**\n     * Helper used to preload a template\n     *\n     * @method loadModal\n     * @param {string} templatekey The property of the global templates variable\n     * @return {object} jQuery promise\n     */\n    List.prototype.loadTemplate = function (templatekey) {\n        var self = this;\n        return Templates.render(self.templates[templatekey], {});\n    }\n\n    return {\n        init: init\n    };\n});"],"file":"list.min.js"}