define(["jquery","local_announcements/audienceselector","core/log","core/modal_factory","core/modal_events","core/templates","core/form-autocomplete"],function(i,e,n,t,o,a,r){"use strict";function l(e){this.rootel=e}return l.prototype.main=function(){var n=this,t=!1;e.init(),n.rootel.on("submit","form[data-form=lann-post]",function(e){if(!t){e.preventDefault(),n.handleSubmit(this)}}),n.rootel.on("click",'form[data-form=lann-post] input[name="cancel"]',function(e){t=!0}),setTimeout(function(){i('select[name="impersonate"]').parent().find(".form-autocomplete-downarrow").click(),i('select[name="impersonate"]').parent().find("input").blur()},3e3)},l.prototype.handleSubmit=function(e){var o=this.rootel.find(".audience-selector").first(),a=!1;i(".roles>ul").removeClass("warn"),this.rootel.find(".contents").each(function(){var e=i(this).find(".item:checked"),n=i(this).find(".role:checked");i(this).data("audiencehasroles")&&0<e.length&&0==n.length&&(a=!0,o.find(".roles>ul").addClass("warn"));var t=o.find(".intersection-workspace.has-tags");t.length&&(a=!0,t.addClass("warn"))}),a||(i(".lann-post-overlay").addClass("active"),e.submit())},{init:function(){n.debug("local_announcements/post: initializing");var e=i("#page-local-announcements-post");e.length?new l(e).main():n.error("local_announcements/post: #page-local-announcements-post not found!")}}});