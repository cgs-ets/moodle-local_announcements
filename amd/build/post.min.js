define(["jquery","local_announcements/audienceselector","core/log","core/modal_factory","core/modal_events","core/templates","core/form-autocomplete"],function(i,n,e,t,o,a,l){"use strict";function r(n){this.rootel=n}return r.prototype.main=function(){var e=this,t=!1;n.init(),e.rootel.on("submit","form[data-form=lann-post]",function(n){if(!t){n.preventDefault(),e.handleSubmit(this)}}),e.rootel.on("click",'form[data-form=lann-post] input[name="cancel"]',function(n){t=!0}),setTimeout(function(){var n=e.rootel.find('select[name="impersonate"]').parent();0<e.rootel.find('input[name="edit"]').val()&&0<n.find('[role="listitem"]').length&&(n.find(".form-autocomplete-downarrow").click(),n.find("input").blur())},3e3)},r.prototype.handleSubmit=function(n){var o=this.rootel.find(".audience-selector").first(),a=!1;i(".roles>ul").removeClass("warn"),this.rootel.find(".contents").each(function(){var n=i(this).find(".item:checked"),e=i(this).find(".role:checked");i(this).data("audiencehasroles")&&0<n.length&&0==e.length&&(a=!0,o.find(".roles>ul").addClass("warn"));var t=o.find(".intersection-workspace.has-tags");t.length&&(a=!0,t.addClass("warn"))}),a||(i(".lann-post-overlay").addClass("active"),n.submit())},{init:function(){e.debug("local_announcements/post: initializing");var n=i("#page-local-announcements-post");n.length?new r(n).main():e.error("local_announcements/post: #page-local-announcements-post not found!")}}});