define(["jquery","local_announcements/audienceselector","local_announcements/impersonateselector","core/log","core/modal_factory","core/modal_events","core/templates","core/form-autocomplete"],function(r,e,t,n,o,a,i,l){"use strict";function c(e){this.rootel=e}return c.prototype.main=function(){var n=this,o=!1;e.init(),t.init(),n.rootel.on("submit","form[data-form=lann-post]",function(e){if(!o){e.preventDefault(),n.handleSubmit(this)}}),n.rootel.on("click",'form[data-form=lann-post] input[name="cancel"]',function(e){o=!0}),n.rootel.on("change","#id_moderator",function(e){n.moderatorChanged()})},c.prototype.moderatorChanged=function(){var e=document.getElementById("id_moderator").value;document.querySelector('input[name="moderatorjson"]').value=e},c.prototype.handleSubmit=function(e){var t=this.rootel.find(".audience-selector").first(),a=!1;r(".roles>ul").removeClass("warn"),this.rootel.find(".contents").each(function(){var e=r(this).find(".item:checked"),n=r(this).find(".role:checked");r(this).data("audiencehasroles")&&0<e.length&&0==n.length&&(a=!0,t.find(".roles>ul").addClass("warn"));var o=t.find(".intersection-workspace.has-tags");o.length&&(a=!0,o.addClass("warn"))}),a||(r(".lann-post-overlay").addClass("active"),e.submit())},{init:function(){n.debug("local_announcements/post: initializing");var e=r("#page-local-announcements-post");e.length?new c(e).main():n.error("local_announcements/post: #page-local-announcements-post not found!")}}});